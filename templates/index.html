{% extends 'base.html' %}
{% load static simple_tags %}
{% block main %}
    <section class="home-slider owl-carousel">
        {% for i in slider  %}
            <div class="slider-item">
                <div class="container">
                    <div class="row d-flex slider-text justify-content-center align-items-center" data-scrollax-parent="true">

                        <div class="img" style="background-image: url({{ i.image.url }});"></div>

                        <div class="text d-flex align-items-center ftco-animate">
                            <div class="text-2 pb-lg-5 mb-lg-4 px-4 px-md-5">
                                <h3 class="subheading mb-3">Featured Posts</h3>
                                <h1 class="mb-5">Love the Delicious &amp; Tasty Foods</h1>
                                <p class="mb-md-5">A small river named Duden flows by their place and supplies it with the necessary regelialia</p>
                                <p><a href="#" class="btn btn-black px-3 px-md-4 py-3">Read More <span
                                    class="icon-arrow_forward ml-lg-4"></span></a></p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        {% endfor %}

    </section>


    <section class="ftco-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7 heading-section ftco-animate">
                    <h2 class="mb-4"><span>Recent Stories</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 order-md-last col-lg-6 ftco-animate">
                    <div class="blog-entry">
                        <div class="img img-big d-flex align-items-end" style="background-image: url({% static 'images/image_2.jpg' %});">
                            <div class="overlay"></div>
                            <div class="text">
                                <span class="subheading">Food</span>
                                <h3><a href="single.html">Tasty &amp; Delicious Foods++</a></h3>
                                <p class="mb-0"><a href="single.html" class="btn-custom">Read More <span
                                    class="icon-arrow_forward ml-4"></span></a></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        {% for i in recent_stories %}
                            <div class="col-md-6 ftco-animate">
                                <div class="blog-entry">
                                    <a href="{% url 'single' i.slug %}" class="img d-flex align-items-end" style="background-image: url({{ i.image.url }});">
                                        <div class="overlay"></div>
                                    </a>
                                    <div class="text pt-3">
                                        <p class="meta d-flex"><span class="pr-3">{{ i.category.name|title }}</span><span class="ml-auto pl-3">{{ i.create_date|date:"F m, Y" }}</span>
                                        </p>
                                        <h3><a href="{% url 'single' i.slug %}">Tasty &amp; {{ i.title|title }}</a></h3>
                                        <p class="mb-0"><a href="{% url 'single' i.slug %}" class="btn-custom">Read More <span
                                            class="icon-arrow_forward ml-4"></span></a></p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section ftco-no-pt">
        <div class="container">
            <div class="row">
                <div class="col-lg-9">
                    <div class="row">
                        <div class="col-md-12 heading-section ftco-animate">
                            <h2 class="mb-4"><span>My Posts</span></h2>
                        </div>
                    </div>
                    <div class="row">
                        {% for i in request.user.story.all %}
                            <div class="col-md-4 ftco-animate">
                                <div class="blog-entry">
                                    <a href="{% url 'single' i.slug %}" class="img-2"><img src="{{ i.image.url }}" class="img-fluid" alt="Colorlib Template"></a>
                                    <div class="text pt-3">
                                        <p class="meta d-flex"><span class="pr-3">{{ i.category.name }}</span><span class="ml-auto pl-3">March 01, 2018</span>
                                        </p>
                                        <h3><a href="{% url 'single' i.slug %}">Tasty &amp; {{ i.title }}</a></h3>
                                        <p class="mb-0"><a href="{% url 'single' i.slug %}" class="btn btn-black py-2">Read More <span
                                            class="icon-arrow_forward ml-4"></span></a></p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="sidebar-wrap">
                        <div class="sidebar-box p-4 about text-center ftco-animate">
                            <h2 class="heading mb-4">About Me</h2>
                            <img src="{{ request.user.profile.image.url }}" class="img-fluid" alt="Colorlib Template">
                            <div class="text pt-4">
                                <p>Hi! My name is <strong>{{ request.user.username|title }}</strong>, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics,
                                    a large language ocean.</p>
                            </div>
                        </div>
                        <div class="sidebar-box p-4 ftco-animate">
                            <form action="#" class="search-form">
                                <div class="form-group">
                                    <span class="icon icon-search"></span>
                                    <input type="text" class="form-control" placeholder="Search">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-12 heading-section ftco-animate">
                            <h2 class="mb-4"><span>Holiday Seasons Recipes</span></h2>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-lg-6 ftco-animate">
                            <div class="blog-entry">
                                <div class="img img-big img-big-2 d-flex align-items-end" style="background-image: url(images/image_1.jpg);">
                                    <div class="overlay"></div>
                                    <div class="text">
                                        <span class="subheading">Food</span>
                                        <h3><a href="#">ham sandwich on white surface</a></h3>
                                        <p class="mb-0"><a href="#" class="btn-custom">Read More <span
                                            class="icon-arrow_forward ml-4"></span></a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6 ftco-animate">
                            <div class="blog-entry">
                                <div class="img img-big img-big-2 d-flex align-items-end" style="background-image: url(images/image_3.jpg);">
                                    <div class="overlay"></div>
                                    <div class="text">
                                        <span class="subheading">Lifestyle</span>
                                        <h3><a href="#">White and red ceramic plate</a></h3>
                                        <p class="mb-0"><a href="#" class="btn-custom">Read More <span
                                            class="icon-arrow_forward ml-4"></span></a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="sidebar-wrap pt-4">
                        <div class="sidebar-box categories text-center ftco-animate">
                            <h2 class="heading mb-4">Categories</h2>
                            <ul class="category-image">
                            {% allCategories as categories %}
                            {% for category in categories %}
                                <li>
                                    <a href="{% url 'stories' category.slug %}" class="img d-flex align-items-center justify-content-center text-center" style="background-image: url({{ category.image.url }});">
                                        <div class="text">
                                            <h3>{{ category.name|title }}</h3>
                                        </div>
                                    </a>
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-counter ftco-section ftco-no-pt ftco-no-pb img" id="section-counter">
        <div class="container">
            <div class="row d-flex">
                <div class="col-md-6 d-flex">
                    <div class="img d-flex align-self-stretch" style="background-image:url(images/about.jpg);"></div>
                </div>
                <div class="col-md-6 pl-md-5 py-5">
                    <div class="row justify-content-start pb-3">
                        <div class="col-md-12 heading-section ftco-animate">
                            <h2 class="mb-4">About Stories</h2>
                            <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 justify-content-center counter-wrap ftco-animate">
                            <div class="block-18 text-center py-5 bg-light mb-4">
                                <div class="text">
                                    <strong class="number" data-number="10">0</strong>
                                    <span>Years of Experienced</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 justify-content-center counter-wrap ftco-animate">
                            <div class="block-18 text-center py-5 bg-light mb-4">
                                <div class="text">
                                    <strong class="number" data-number="200">0</strong>
                                    <span>Foods</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 justify-content-center counter-wrap ftco-animate">
                            <div class="block-18 text-center py-5 bg-light mb-4">
                                <div class="text">
                                    <strong class="number" data-number="300">0</strong>
                                    <span>Lifestyle</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 justify-content-center counter-wrap ftco-animate">
                            <div class="block-18 text-center py-5 bg-light mb-4">
                                <div class="text">
                                    <strong class="number" data-number="40">0</strong>
                                    <span>Happy Customers</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="ftco-subscribe ftco-section bg-light">
        <div class="overlay">
            <div class="container">
                <div class="row d-flex justify-content-center">
                    <div class="col-md-8 text-wrap text-center heading-section ftco-animate">
                        <h2 class="mb-4"><span>Subcribe to our Newsletter</span></h2>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>
                        <div class="row d-flex justify-content-center mt-4 mb-4">
                            <div class="col-md-8">
                                <form action="" class="subscribe-form" id="my-form" onsubmit="return false" >
                                    {% csrf_token %}
                                    <div class="form-group d-flex">
                                        <input type="text" class="form-control" placeholder="Enter email address" name="email">
                                        <input type="button" value="Subscribe" class="submit px-3" onclick="subscribe()">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascript %}
    <script>
        const a = {name:'cavid'}
        function subscribe(){
            const param = document.getElementById('my-form');
            const token = param.elements[0].value;
            const email = param.elements[1];

            const xhttp = new XMLHttpRequest();  
            xhttp.open('POST', 'http://127.0.0.1:8000/en/subscribe/', true);
            xhttp.onload = ()=>{
                const response = JSON.parse(xhttp.responseText);
                
                if(xhttp.status == '200'){
                    alert(response['message'])
                }
                else{
                    alert(response['message'])
                }
            }
            xhttp.setRequestHeader('X-CSRFToken', token)
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send(`email=${email.value}`);
            email.value = '';
        }
    </script>
{% endblock %}